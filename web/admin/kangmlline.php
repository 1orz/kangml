<!DOCTYPE html>  <html lang="en"><head>    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1">    <meta name="description" content="">    <meta name="author" content="">    <link rel="icon" type="image/png" sizes="16x16" href="../plugins/images/favicon.png">    <title>康师傅流控管理后台</title>    <!-- Bootstrap Core CSS -->    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">    <!-- Menu CSS -->    <link href="../plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css" rel="stylesheet">    <!-- animation CSS -->    <link href="css/animate.css" rel="stylesheet">    <!-- Custom CSS -->    <link href="css/style.css" rel="stylesheet">    <!-- color CSS -->    <link href="css/colors/default.css" id="theme" rel="stylesheet">    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->    <!--[if lt IE 9]>    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]-->    <script>        (function (i, s, o, g, r, a, m) {            i['GoogleAnalyticsObject'] = r;            i[r] = i[r] || function () {                (i[r].q = i[r].q || []).push(arguments)            }, i[r].l = 1 * new Date();            a = s.createElement(o), m = s.getElementsByTagName(o)[0];            a.async = 1;            a.src = g;            m.parentNode.insertBefore(a, m)        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');        ga('create', 'UA-19175540-9', 'auto');        ga('send', 'pageview');    </script></head><?php     include 'php/header.php';    include 'php/left-sidebar.php';?>    <!-- Page Content -->    <div id="page-wrapper">        <div class="container-fluid">            <div class="row bg-title">                <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">                    <h4 class="page-title">官网线路推送</h4> </div>                <!-- /.col-lg-12 -->            </div>            <!-- /row --><?php$kangmlDB = new DB("gz-cdb-6v9d68vj.sql.tencentcdb.com","kangmlline","kangmlline!@","ov",62373);if ($_GET["act"] == "addLine") {        $lineid = $_GET["id"];        $lineres = $kangmlDB->get_row("SELECT * FROM `line` WHERE `id` = $lineid;");        $name = $lineres['name'];        $type = $lineres['type'];        $label = $lineres['label'];        $content = $lineres['content'];        $group = $lineres['group'];        $show = 0;        $time = time();        if($sql=$DB->query("INSERT INTO `line` (`id`, `name`, `content`, `type`, `group`, `show`, `label`, `order`, `time`) VALUES (NULL, '$name', '$content', '$type', '$group', '$show', '$label', '0', '$time');")){            echo '<div class="alert alert-success alert-dismissable">    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">    &times;    </button>新增线路【'.$name.'】成功！默认为禁用状态！请到线路列表开启线路显示！</div>';        }else{            echo '<div class="alert alert-danger alert-dismissable">    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">    &times;    </button> 线路操作失败！</div>';        }}if ($_GET["act"] == "addLinePL") {  $arr = $_GET["item"];  for ($i=0; $i < count($arr); $i++) {         $lineres = $kangmlDB->get_row("SELECT * FROM `line` WHERE `id` = $arr[$i];");        $name = $lineres['name'];        $type = $lineres['type'];        $label = $lineres['label'];        $content = $lineres['content'];        $group = $lineres['group'];        $show = 0;        $time = time();        if($sql=$DB->query("INSERT INTO `line` (`id`, `name`, `content`, `type`, `group`, `show`, `label`, `order`, `time`) VALUES (NULL, '$name', '$content', '$type', '$group', '$show', '$label', '0', '$time');"))        {}        else        {    echo '<div class="alert alert-danger alert-dismissable">    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">    &times;    </button> 线路操作失败！</div>';    exit;        }  }  echo '<div class="alert alert-success alert-dismissable">    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">    &times;    </button>批量添加线路成功！默认为禁用状态！请到线路列表开启线路显示！</div>';}if(@$_GET["gid"] == ""){  $data = [];}else{  $where[] = "`group`=:group ";  $data[":group"] = $_GET["gid"];}if(@$_GET["kw"] != ""){  $where[] = " name LIKE :name";  $data[":name"] = "%".$_GET["kw"]."%";}if(!empty($_GET['kw'])) {  $sql=" `name` LIKE '%{$_GET['kw']}%'";  $numrows=$kangmlDB->count("SELECT count(*) from `line` WHERE{$sql};");  $con='官网共推送 '.$numrows.' 条线路';}else{  $numrows=$kangmlDB->count("SELECT count(*) from `line` WHERE 1;");  $sql=" 1";  $con='官网共推送 '.$numrows.' 条线路';}?>            <div class="row">                 <div class="col-sm-16">            <div class="white-box">            <form action="kangmlline.php" method="get" role="form" class="form-inline pull-right">                    <div class="input-group">                    <input type="text" name="kw" class="form-control" placeholder="线路名称(可在此找自己地区)" value="<?php echo $_GET["kw"];?>" required>                     <span class="input-group-btn">                    <button type="submit" class="btn waves-effect waves-light btn-info"><i class="fa fa-search"></i></button>                    </span></div>                     </form>                    <h3 class="box-title m-b-0"><?php echo $con; ?></h3>                    <form action="kangmlline.php" method="get" role="form">                    <input type="hidden" name="act" value="addLinePL">                    <input type="submit" class="btn btn-danger btn-sm" value="批量添加选中线路">                                </div>                  <div class="white-box">                    <div class="table-responsive">                    <!-- <button type="button" class="btn btn-warning btn-xs">线路分类</button> --><?phpif(@$_GET["gid"] == ""){  echo '<div style="clear:both;height:8px;"></div><span class="label label-info" ><a href="?'.$t_str.'" style="color:#fff">全部</a></span>';}else{  echo '<div style="clear:both;height:8px;"></div>&nbsp;&nbsp;&nbsp;&nbsp;<span ><a href="?'.$t_str.'" >全部</a></span>';}$rs=$kangmlDB->query("SELECT * FROM `line_grop`");foreach($rs as $res){  if($res['id'] == $_GET["gid"]){    echo '&nbsp;&nbsp;&nbsp;&nbsp;<span class="label label-info" ><a href="?gid='.$res["id"].'" style="color:#fff">'.$res['name'].'</a></span>';  }else{    echo '&nbsp;&nbsp;&nbsp;&nbsp;<span><a href="?gid='.$res["id"].'">'.$res['name'].'</a></span>';  }}                                          $pagesize=30;                                          $pages=intval($numrows/$pagesize);                                          if ($numrows%$pagesize)                                          {                                           $pages++;                                           }                                          if (isset($_GET['page'])){                                          $page=intval($_GET['page']);                                          }                                          else{                                          $page=1;                                          }                                          $offset=$pagesize*($page - 1);?><div style="clear:both;height:10px;"></div>                            <table class="table table-bordered table-striped">                                <thead>                                    <tr>                                        <th>#</th>                                        <th>ID</th>                                        <th data-priority="1">名称</th>                                        <th data-priority="3">类型</th>                                        <th data-priority="6">说明</th>                                        <th data-priority="6">时间</th>                                        <th data-priority="6">操作</th>                                    </tr>                                </thead>                                <tbody>                                      <?php                                                                                                                  if (empty($_GET['gid']))                                      {                                        $list=$kangmlDB->query("SELECT * FROM `line` WHERE{$sql} order by id desc limit $offset,$pagesize;");                                      }                                      else{                                        $Getgid = $_GET['gid'];                                        $list=$kangmlDB->query("SELECT * FROM `line` WHERE{$sql} AND `group` LIKE '$Getgid' order by id desc limit $offset,$pagesize;");                                      }                                      foreach($list as $vo){                                        $name = $vo['name'];                                        if ($DB->get_row("SELECT * FROM `line` WHERE `name` LIKE '$name'") != ""){}else{                                            ?>                                          <tr class=" line-id-<?=$vo['id']?>">      <td><input type="checkbox" value='<?=$vo['id']?>' name="item[]" /></td>      <td><?=$vo['id']?></td>      <td><?=$vo['name']?></td>      <td><?=$vo['type']?></td>      <td><?=$vo['label']?></td>      <td><?=$vo['time']?></td>            <td><a type="button" class="btn btn-success btn-xs" onclick="window.location.href='kangmlline.php?act=addLine&id=<?=$vo['id']?>'" target="download">添加到本地</a></td>    </tr>                                          <?php }}                                          ?>                                          </form>                                </tbody>                            </table>                        </div>                        <?php                      echo'<ul class="pagination pagination-sm waves-effect">';                      $first=1;                      $prev=$page-1;                      $next=$page+1;                      $last=$pages;                      if ($page>1)                      {                      echo '<li><a href="kangmlline.php?page='.$first.$link.'">首页</a></li>';                      echo '<li><a href="kangmlline.php?page='.$prev.$link.'">&laquo;</a></li>';                      } else {                      echo '<li class="disabled"><a>首页</a></li>';                      echo '<li class="disabled"><a>&laquo;</a></li>';                      }                      for ($i=1;$i<$page;$i++)                      echo '<li><a href="kangmlline.php?page='.$i.$link.'">'.$i .'</a></li>';                      echo '<li class="disabled"><a>'.$page.'</a></li>';                      for ($i=$page+1;$i<=$pages;$i++)                      echo '<li><a href="kangmlline.php?page='.$i.$link.'">'.$i .'</a></li>';                      echo '';                      if ($page<$pages)                      {                      echo '<li><a href="kangmlline.php?page='.$next.$link.'">&raquo;</a></li>';                      echo '<li><a href="kangmlline.php?page='.$last.$link.'">尾页</a></li>';                      } else {                      echo '<li class="disabled"><a>&raquo;</a></li>';                      echo '<li class="disabled"><a>尾页</a></li>';                      }                      echo'</ul>';                      #分页                                            ?>                    </div>                                  </div>            </div>            <!-- /.row -->            <?php include 'php/right-sidebar.php';?>        </div>        <!-- /.container-fluid -->        <?php include 'php/footer.php';?>    </div>    <!-- /#page-wrapper -->    </div><iframe name="download" style="display:none"></iframe>    <!-- /#wrapper -->    <!-- jQuery -->    <script src="../plugins/bower_components/jquery/dist/jquery.min.js"></script>    <!-- Bootstrap Core JavaScript -->    <script src="bootstrap/dist/js/bootstrap.min.js"></script>    <!-- Menu Plugin JavaScript -->    <script src="../plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js"></script>    <!--slimscroll JavaScript -->    <script src="js/jquery.slimscroll.js"></script>    <!--Wave Effects -->    <script src="js/waves.js"></script>    <!-- Custom Theme JavaScript -->    <script src="js/custom.min.js"></script>    <!-- jQuery peity -->    <script src="../plugins/bower_components/peity/jquery.peity.min.js"></script>    <script src="../plugins/bower_components/peity/jquery.peity.init.js"></script>    <!--Style Switcher -->    <script src="../plugins/bower_components/styleswitcher/jQuery.style.switcher.js"></script>    <!--Style Switcher --><script src="../plugins/bower_components/styleswitcher/jQuery.style.switcher.js"></script></body></html>